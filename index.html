<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicadores Estrat√©gicos - Sa√∫de Integral</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#879ACF',
                        secondary: '#0E334C',
                        accent: '#FA3268',
                        success: '#8CD000',
                        white: '#FFFFFF'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-primary/10 to-secondary/10 min-h-screen">
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- üöÄ SISTEMA AVAN√áADO DE SINCRONIZA√á√ÉO MULTI-DISPOSITIVO -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <!-- Status de Conex√£o no Rodap√© -->
    <div id="connectionStatus" class="fixed bottom-4 left-4 z-50 bg-white rounded-lg shadow-lg p-3 border-l-4 border-success">
        <div class="flex items-center gap-2">
            <div id="statusIndicator" class="w-3 h-3 bg-success rounded-full animate-pulse"></div>
            <span id="statusText" class="text-sm font-semibold text-secondary">Sistema Online</span>
        </div>
        <div id="syncInfo" class="text-xs text-gray-600 mt-1">
            <span id="deviceCount">1 dispositivo conectado</span> ‚Ä¢ 
            <span id="lastSync">Sincronizado agora</span>
        </div>
    </div>

    <!-- Notifica√ß√µes em Tempo Real -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Header -->
    <header class="bg-gradient-to-r from-secondary via-secondary to-primary text-white shadow-2xl border-b-4 border-accent">
        <div class="container mx-auto px-6 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="bg-white p-2 rounded-xl shadow-lg">
                        <img src="https://logosdown.com/wp-content/uploads/2023/08/bayer-logo-0-1536x1536.png" alt="Bayer Logo" class="w-10 h-10 object-contain">
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold tracking-tight" data-translate="main_title">INDICADORES ESTRAT√âGICOS</h1>
                        <p class="text-primary/90 font-medium text-lg" data-translate="subtitle">SA√öDE INTEGRAL R&D LATAM</p>
                    </div>
                </div>
                <div class="flex gap-4 items-center">
                    <div class="flex gap-3">
                        <button onclick="changeLanguage('pt')" id="btnPT" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-300 border border-white/30 shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2">
                            <img src="https://static.todamateria.com.br/upload/ba/nd/bandeira-do-brasil-og.jpg" alt="Brasil" class="w-5 h-3 object-cover rounded-sm shadow-sm border border-white/20">
                            PT
                        </button>
                        <button onclick="changeLanguage('es')" id="btnES" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-300 border border-white/20 shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2">
                            <img src="https://imagepng.org/wp-content/uploads/2017/09/bandeira-espanha.png" alt="Espa√±a" class="w-5 h-3 object-cover rounded-sm shadow-sm border border-white/20">
                            ES
                        </button>
                    </div>
                    <div class="w-px h-6 bg-white/30"></div>
                    <button onclick="showLogin('user')" class="bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 px-6 py-3 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 border border-white/20">
                        <span data-translate="user_button">Usu√°rio</span>
                    </button>
                    <button onclick="showLogin('admin')" class="bg-gradient-to-r from-accent to-accent/80 hover:from-accent/90 hover:to-accent/70 px-6 py-3 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 border border-white/20">
                        <span data-translate="admin_button">Administrador</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main id="dashboard" class="container mx-auto px-6 py-8 min-h-screen">
        <!-- Chart Filters -->
        <div class="bg-gradient-to-r from-white to-gray-50 rounded-2xl shadow-2xl p-8 mb-8 border border-gray-100">
            <div class="flex items-center mb-6">
                <div class="bg-gradient-to-r from-primary to-accent p-3 rounded-xl mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-secondary" data-translate="chart_filters">Filtros dos Gr√°ficos</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="relative">
                    <label class="block text-sm font-semibold text-secondary mb-2" data-translate="country_label">Pa√≠s</label>
                    <select id="chartFilterCountry" onchange="updateCharts()" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm hover:shadow-md">
                        <option value="" data-translate="all_countries">Todos os Pa√≠ses</option>
                        <option value="brasil">Brasil</option>
                        <option value="argentina">Argentina</option>
                        <option value="chile">Chile</option>
                        <option value="mexico">M√©xico</option>
                    </select>
                </div>
                <div class="relative">
                    <label class="block text-sm font-semibold text-secondary mb-2" data-translate="location_label">Localidade</label>
                    <select id="chartFilterSite" onchange="updateCharts()" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm hover:shadow-md">
                        <option value="" data-translate="all_locations">Todas as Localidades</option>
                        <option value="petrolina">Petrolina</option>
                        <option value="sorriso">Sorriso</option>
                        <option value="uberlandia">Uberl√¢ndia</option>
                        <option value="rolandia">Rol√¢ndia</option>
                    </select>
                </div>
                <div class="relative">
                    <label class="block text-sm font-semibold text-secondary mb-2" data-translate="business_label">Neg√≥cio</label>
                    <select id="chartFilterBusiness" onchange="updateCharts()" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm hover:shadow-md">
                        <option value="" data-translate="all_businesses">Todos os Neg√≥cios</option>
                        <option value="field-testing">Field Testing</option>
                        <option value="pipeline-delivery">Pipeline Delivery</option>
                        <option value="biotech">Biotech</option>
                    </select>
                </div>
                <div class="relative">
                    <label class="block text-sm font-semibold text-secondary mb-2" data-translate="year_label">Ano</label>
                    <select id="chartFilterYear" onchange="updateCharts()" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm hover:shadow-md">
                        <option value="" data-translate="all_years">Todos os Anos</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 border border-gray-100 hover:shadow-3xl transition-all duration-300">
                <div class="flex items-center mb-6">
                    <div class="bg-gradient-to-r from-secondary to-primary p-3 rounded-xl mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-secondary" data-chart-title="absenteeism_general">Absente√≠smo Geral (%)</h3>
                        <p class="text-sm text-gray-600 font-medium" data-translate="formula_text">F√≥rmula: (Dias perdidos / Dias contratados) √ó 100</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-inner">
                    <canvas id="absenteeismGeneralChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 border border-gray-100 hover:shadow-3xl transition-all duration-300">
                <div class="flex items-center mb-6">
                    <div class="bg-gradient-to-r from-accent to-primary p-3 rounded-xl mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-secondary" data-chart-title="absenteeism_location">Absente√≠smo por Localidade (%)</h3>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-inner">
                    <canvas id="absenteeismLocationChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 border border-gray-100 hover:shadow-3xl transition-all duration-300">
                <div class="flex items-center mb-6">
                    <div class="bg-gradient-to-r from-success to-accent p-3 rounded-xl mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-secondary" data-chart-title="absenteeism_category">Absente√≠smo por Categoria CID (%)</h3>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-inner">
                    <canvas id="absenteeismCategoryChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 border border-gray-100 hover:shadow-3xl transition-all duration-300">
                <div class="flex items-center mb-6">
                    <div class="bg-gradient-to-r from-primary to-secondary p-3 rounded-xl mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-secondary" data-chart-title="absenteeism_trend">Tend√™ncia Mensal de Absente√≠smo (%)</h3>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-inner">
                    <canvas id="absenteeismTrendChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 mb-8 border border-gray-100 hover:shadow-3xl transition-all duration-300">
            <div class="flex items-center mb-6">
                <div class="bg-gradient-to-r from-accent to-success p-3 rounded-xl mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-secondary" data-chart-title="absenteeism_comparison">Comparativo FTE vs Safristas - Absente√≠smo (%)</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-inner">
                <canvas id="absenteeismComparisonChart" width="800" height="300"></canvas>
            </div>
        </div>

        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 border border-gray-100">
            <div class="flex items-center mb-6">
                <div class="bg-gradient-to-r from-accent to-secondary p-3 rounded-xl mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-secondary" data-translate="sites_no_response">Sites sem Resposta no M√™s</h3>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white border border-accent/30 rounded-lg p-4 shadow-sm">
                    <h4 class="font-semibold text-accent text-base mb-2">Caranda√≠</h4>
                    <p class="text-sm text-gray-600"><span data-translate="last_response">√öltima resposta</span>: <span class="text-accent font-medium">Outubro</span></p>
                </div>
                <div class="bg-white border border-accent/30 rounded-lg p-4 shadow-sm">
                    <h4 class="font-semibold text-accent text-base mb-2">El Tizate</h4>
                    <p class="text-sm text-gray-600"><span data-translate="last_response">√öltima resposta</span>: <span class="text-accent font-medium">Setembro</span></p>
                </div>
                <div class="bg-white border border-accent/30 rounded-lg p-4 shadow-sm">
                    <h4 class="font-semibold text-accent text-base mb-2">Rio IV</h4>
                    <p class="text-sm text-gray-600"><span data-translate="last_response">√öltima resposta</span>: <span class="text-accent font-medium">Outubro</span></p>
                </div>
            </div>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-10 w-full max-w-md mx-4 border border-gray-200">
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-primary to-accent p-4 rounded-2xl w-16 h-16 mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
                <h2 id="loginTitle" class="text-3xl font-bold text-secondary" data-translate="login_title">Acesso ao Sistema</h2>
                <p class="text-gray-600 font-medium" data-translate="login_subtitle">Digite suas credenciais</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-bold text-secondary mb-3" data-translate="email_label">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm" required>
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-secondary mb-3" data-translate="password_label">Senha</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm" required>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white py-4 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105" data-translate="login_button">
                    Entrar
                </button>
                
                <div class="text-center">
                    <button type="button" onclick="showForgotPassword()" class="text-primary hover:text-accent font-semibold transition-colors duration-300" data-translate="forgot_password">
                        Esqueceu a senha?
                    </button>
                </div>
            </form>
            
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-accent transition-colors duration-300 bg-white/80 rounded-full p-2 hover:bg-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-10 w-full max-w-md mx-4 border border-gray-200">
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-accent to-secondary p-4 rounded-2xl w-16 h-16 mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-secondary" data-translate="forgot_title">Recuperar Senha</h2>
                <p class="text-gray-600 font-medium" data-translate="forgot_subtitle">Digite seu email para receber instru√ß√µes</p>
            </div>
            
            <form id="forgotForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-bold text-secondary mb-3" data-translate="email_label">Email</label>
                    <input type="email" id="forgotEmail" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm" required>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-white py-4 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105" data-translate="send_email">
                    Enviar Email
                </button>
                
                <button type="button" onclick="closeForgotModal()" class="w-full text-gray-600 hover:text-secondary font-semibold py-3 transition-colors duration-300" data-translate="back_to_login">
                    Voltar ao Login
                </button>
            </form>
            
            <button onclick="closeForgotModal()" class="absolute top-4 right-4 text-gray-400 hover:text-accent transition-colors duration-300 bg-white/80 rounded-full p-2 hover:bg-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <div class="bg-secondary text-white p-4">
            <div class="container mx-auto flex justify-between items-center">
                <h2 class="text-xl font-bold">Painel Administrativo</h2>
                <div class="flex gap-4">
                    <button onclick="showAddUser()" class="bg-success hover:bg-success/80 px-4 py-2 rounded-lg">
                        + Novo Usu√°rio
                    </button>
                    <button onclick="showChangePassword()" class="bg-secondary hover:bg-secondary/80 px-4 py-2 rounded-lg">
                        Alterar Senha
                    </button>
                    <button onclick="showManageAdmins()" class="bg-primary hover:bg-primary/80 px-4 py-2 rounded-lg">
                        Gerenciar Admins
                    </button>
                    <button onclick="exportExcel()" class="bg-primary hover:bg-primary/80 px-4 py-2 rounded-lg">
                        Exportar Excel
                    </button>
                    <button onclick="logout()" class="bg-accent hover:bg-accent/80 px-4 py-2 rounded-lg">
                        Sair
                    </button>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-6 py-6">
            <!-- Filters -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-secondary mb-4">Filtros</h3>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary">
                        <option>Todos os Meses</option>
                        <option>Janeiro</option>
                        <option>Fevereiro</option>
                        <option>Mar√ßo</option>
                    </select>
                    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary">
                        <option>Todas as Localidades</option>
                        <option>Brasil</option>
                        <option>Argentina</option>
                        <option>Chile</option>
                    </select>
                    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary">
                        <option>Todos os Neg√≥cios</option>
                        <option>Field Testing</option>
                        <option>Pipeline Delivery</option>
                        <option>Biotech</option>
                    </select>
                    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary">
                        <option>Todos os Anos</option>
                        <option>2024</option>
                        <option>2025</option>
                    </select>
                    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary">
                        <option>Todos os Usu√°rios</option>
                        <option>Jo√£o Silva</option>
                        <option>Maria Santos</option>
                        <option>Carlos Rodriguez</option>
                    </select>
                </div>
            </div>

            <!-- User Responses Table -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold text-secondary mb-4">Respostas dos Usu√°rios</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left font-semibold text-secondary">Usu√°rio</th>
                                <th class="px-4 py-3 text-left font-semibold text-secondary">Site</th>
                                <th class="px-4 py-3 text-left font-semibold text-secondary">M√™s/Ano</th>
                                <th class="px-4 py-3 text-left font-semibold text-secondary">Absente√≠smo</th>
                                <th class="px-4 py-3 text-left font-semibold text-secondary">Status</th>
                                <th class="px-4 py-3 text-left font-semibold text-secondary">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="adminTableBody" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                                    Nenhuma resposta encontrada
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- User Panel -->
    <div id="userPanel" class="hidden">
        <div class="bg-primary text-white p-4">
            <div class="container mx-auto flex justify-between items-center">
                <h2 class="text-xl font-bold">Painel do Usu√°rio</h2>
                <div class="flex gap-4">
                    <button onclick="showHistory()" class="bg-secondary hover:bg-secondary/80 px-4 py-2 rounded-lg">
                        Hist√≥rico
                    </button>
                    <button onclick="showChangePassword()" class="bg-primary hover:bg-primary/80 px-4 py-2 rounded-lg">
                        Alterar Senha
                    </button>
                    <button onclick="logout()" class="bg-accent hover:bg-accent/80 px-4 py-2 rounded-lg">
                        Sair
                    </button>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-6 py-6">
            <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 border border-gray-100">
                <div class="text-center mb-8">
                    <div class="bg-gradient-to-r from-primary to-accent p-4 rounded-2xl w-16 h-16 mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-3xl font-bold text-secondary mb-2" data-translate="questionnaire_title">Question√°rio - Indicadores Estrat√©gicos</h3>
                    <p class="text-gray-600 font-medium" data-translate="questionnaire_subtitle">Preencha os dados mensais do seu site</p>
                </div>
                
                <form id="indicatorsForm" class="space-y-10">
                    <!-- Informa√ß√£o Geral -->
                    <div class="bg-gradient-to-r from-primary/5 to-accent/5 rounded-2xl p-8 border border-primary/20">
                        <div class="flex items-center mb-6">
                            <div class="bg-gradient-to-r from-primary to-accent p-3 rounded-xl mr-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-2xl font-bold text-secondary" data-translate="general_info">INFORMA√á√ÉO GERAL</h4>
                                <p class="text-gray-600 font-medium" data-translate="general_info_desc">Dados b√°sicos do per√≠odo e localiza√ß√£o</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                                <label class="block text-lg font-bold text-secondary mb-4" data-translate="year_question">1. Ano (selecione apenas um)</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-primary hover:bg-primary/5 transition-all duration-300 cursor-pointer">
                                        <input type="radio" name="year" value="2024" class="text-primary focus:ring-primary mr-3">
                                        <span class="font-semibold">2024</span>
                                    </label>
                                    <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-primary hover:bg-primary/5 transition-all duration-300 cursor-pointer">
                                        <input type="radio" name="year" value="2025" class="text-primary focus:ring-primary mr-3">
                                        <span class="font-semibold">2025</span>
                                    </label>
                                </div>
                            </div>

                            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                                <label class="block text-lg font-bold text-secondary mb-4" data-translate="month_question">2. M√™s (selecione apenas um)</label>
                                <select name="month" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm hover:shadow-md font-semibold">
                                    <option value="" data-translate="select_month">Selecione o m√™s</option>
                                    <option value="janeiro" data-translate="january">Janeiro</option>
                                    <option value="fevereiro" data-translate="february">Fevereiro</option>
                                    <option value="marco" data-translate="march">Mar√ßo</option>
                                    <option value="abril" data-translate="april">Abril</option>
                                    <option value="maio" data-translate="may">Maio</option>
                                    <option value="junho" data-translate="june">Junho</option>
                                    <option value="julho" data-translate="july">Julho</option>
                                    <option value="agosto" data-translate="august">Agosto</option>
                                    <option value="setembro" data-translate="september">Setembro</option>
                                    <option value="outubro" data-translate="october">Outubro</option>
                                    <option value="novembro" data-translate="november">Novembro</option>
                                    <option value="dezembro" data-translate="december">Dezembro</option>
                                </select>
                            </div>

                            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                                <label class="block text-lg font-bold text-secondary mb-4" data-translate="business_question">3. Neg√≥cio Principal</label>
                                <select name="business" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm hover:shadow-md font-semibold">
                                    <option value="" data-translate="select_business">Selecione o neg√≥cio</option>
                                    <option value="field-testing">Field Testing</option>
                                    <option value="pipeline-delivery">Pipeline Delivery</option>
                                    <option value="biotech">Biotech</option>
                                    <option value="regulatory">Regulatory</option>
                                    <option value="agronomic-service">Agronomic Service</option>
                                    <option value="field-solutions">Field Solutions</option>
                                    <option value="vegetables">Vegetables</option>
                                </select>
                            </div>

                            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                                <label class="block text-lg font-bold text-secondary mb-4" data-translate="country_question">4. Pa√≠s</label>
                                <select name="country" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm hover:shadow-md font-semibold">
                                    <option value="" data-translate="select_country">Selecione o pa√≠s</option>
                                    <option value="argentina">Argentina</option>
                                    <option value="paraguai" data-translate="paraguay">Paraguai</option>
                                    <option value="chile">Chile</option>
                                    <option value="mexico" data-translate="mexico">M√©xico</option>
                                    <option value="guatemala">Guatemala</option>
                                    <option value="el-salvador">El Salvador</option>
                                    <option value="brasil" data-translate="brazil">Brasil</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">5. Site</label>
                                <select name="site" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary">
                                    <option value="">Selecione o site</option>
                                    <option value="petrolina">Petrolina</option>
                                    <option value="porto-nacional">Porto Nacional</option>
                                    <option value="sorriso">Sorriso - Hub Norte</option>
                                    <option value="coxilha">Coxilha - Hub Sul</option>
                                    <option value="rolandia">Rol√¢ndia - Hub Sul</option>
                                    <option value="santa-rita">Santa Rita - Hub Sul</option>
                                    <option value="uberlandia-centro">Uberl√¢ndia - Hub Centro Norte</option>
                                    <option value="guatemala-salvador">Guatemala / El Salvador - Hub Norla</option>
                                    <option value="uberlandia-ctb">Uberl√¢ndia CTB</option>
                                    <option value="nao-me-toque">N√£o Me Toque</option>
                                    <option value="santa-cruz">Santa Cruz das Palmeiras</option>
                                    <option value="paulinia">Paul√≠nia</option>
                                    <option value="carandai">Caranda√≠</option>
                                    <option value="luis-eduardo">Lu√≠s Eduardo Magalh√£es</option>
                                    <option value="fontezuela">Fontezuela</option>
                                    <option value="santa-julia">Santa Julia / Temuco</option>
                                    <option value="el-tizate">El Tizate</option>
                                    <option value="san-juan">San Juan de Abajo</option>
                                    <option value="la-charca">La Charca</option>
                                    <option value="tlajomulco">Tlajomulco</option>
                                    <option value="rio-iv">Rio IV</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">6. Quantidade de FTE ativo do site</label>
                                <input type="number" name="fte_count" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">7. Quantidade de safristas ativos do site</label>
                                <input type="number" name="seasonal_count" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-secondary mb-2">8. Observa√ß√µes</label>
                                <textarea name="general_observations" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Deixar em branco se n√£o h√° nada"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Licen√ßa M√©dica -->
                    <div class="bg-gradient-to-r from-accent/5 to-success/5 rounded-2xl p-8 border border-accent/20">
                        <div class="flex items-center mb-6">
                            <div class="bg-gradient-to-r from-accent to-success p-3 rounded-xl mr-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-2xl font-bold text-secondary" data-translate="medical_leave">LICEN√áA M√âDICA</h4>
                                <p class="text-gray-600 font-medium" data-translate="medical_leave_desc">Dados de afastamentos por motivos de sa√∫de</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">9. Dias de licen√ßa m√©dica (todos os motivos) - FTE</label>
                                <input type="number" name="medical_leave_fte_all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">10. Dias de licen√ßa m√©dica (todos os motivos) - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">11. Dias de licen√ßa m√©dica por CID F - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_f" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">12. Dias de licen√ßa m√©dica por CID F - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_f" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">13. Dias de licen√ßa m√©dica por CID M - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_m" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">14. Dias de licen√ßa m√©dica por CID M - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_m" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">15. Dias de licen√ßa m√©dica por CID S - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_s" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">16. Dias de licen√ßa m√©dica por CID S - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_s" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">17. Dias de licen√ßa m√©dica por CID Z - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_z" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">18. Dias de licen√ßa m√©dica por CID Z - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_z" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">19. Dias de licen√ßa m√©dica por CID R - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_r" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">20. Dias de licen√ßa m√©dica por CID R - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_r" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">21. Dias de licen√ßa m√©dica por CID O - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_o" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">22. Dias de licen√ßa m√©dica por CID O - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_o" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">23. Dias de licen√ßa m√©dica por CID J - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_j" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">24. Dias de licen√ßa m√©dica por CID J - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_j" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">25. Dias de licen√ßa m√©dica por CID A e B - FTE</label>
                                <input type="number" name="medical_leave_fte_cid_ab" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">26. Dias de licen√ßa m√©dica por CID A e B - Safristas</label>
                                <input type="number" name="medical_leave_seasonal_cid_ab" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-secondary mb-2">27. Observa√ß√µes</label>
                                <textarea name="medical_observations" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Deixar em branco se n√£o h√° nada"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Afastamentos Previdenci√°rios -->
                    <div class="border-b border-gray-200 pb-6">
                        <h4 class="text-lg font-semibold text-secondary mb-4">AFASTAMENTOS PREVIDENCI√ÅRIOS / SEGURO SOCIAL</h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">28. Colaboradores com afastamento previdenci√°rio (qualquer motivo) - FTE</label>
                                <input type="number" name="social_security_leave_fte_all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">29. Colaboradores com afastamento previdenci√°rio (qualquer motivo) - Safristas</label>
                                <input type="number" name="social_security_leave_seasonal_all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">30. Afastamento por licen√ßa maternidade - FTE</label>
                                <input type="number" name="maternity_leave_fte" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">31. Afastamento por licen√ßa maternidade - Safristas</label>
                                <input type="number" name="maternity_leave_seasonal" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">32. Afastamento por aposentadoria por invalidez - FTE</label>
                                <input type="number" name="disability_retirement_fte" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">33. Afastamento por aposentadoria por invalidez - Safristas</label>
                                <input type="number" name="disability_retirement_seasonal" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary mb-2">34. Afastamento por acidente de trabalho (esp√©cie B91) - FTE</label>
                                <input type="number" name="work_accident_fte" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0" step="1" pattern="[0-9]*" inputmode="numeric">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between pt-6">
                        <div class="flex gap-4">
                            <button type="button" onclick="saveDraft()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold">
                                Salvar Rascunho
                            </button>
                            <button type="button" onclick="loadDraft()" class="bg-primary hover:bg-primary/80 text-white px-6 py-3 rounded-lg font-semibold">
                                Carregar Rascunho
                            </button>
                        </div>
                        <button type="submit" class="bg-success hover:bg-success/80 text-white px-6 py-3 rounded-lg font-semibold">
                            Enviar Respostas
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-10 w-full max-w-md mx-4 border border-gray-200">
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-primary to-accent p-4 rounded-2xl w-16 h-16 mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-secondary" data-translate="change_password">Alterar Senha</h2>
                <p class="text-gray-600 font-medium">Digite sua senha atual e a nova senha</p>
            </div>
            
            <form id="changePasswordForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-bold text-secondary mb-3" data-translate="current_password">Senha Atual</label>
                    <input type="password" id="currentPassword" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm" required>
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-secondary mb-3" data-translate="new_password">Nova Senha</label>
                    <input type="password" id="newPassword" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm" required>
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-secondary mb-3" data-translate="confirm_password">Confirmar Nova Senha</label>
                    <input type="password" id="confirmPassword" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm" required>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white py-4 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105" data-translate="save_password">
                    Salvar Nova Senha
                </button>
                
                <button type="button" onclick="closeChangePasswordModal()" class="w-full text-gray-600 hover:text-secondary font-semibold py-3 transition-colors duration-300" data-translate="cancel">
                    Cancelar
                </button>
            </form>
            
            <button onclick="closeChangePasswordModal()" class="absolute top-4 right-4 text-gray-400 hover:text-accent transition-colors duration-300 bg-white/80 rounded-full p-2 hover:bg-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Manage Admins Modal -->
    <div id="manageAdminsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-10 w-full max-w-2xl mx-4 border border-gray-200">
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-primary to-accent p-4 rounded-2xl w-16 h-16 mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-secondary">Gerenciar Administradores</h2>
                <p class="text-gray-600 font-medium">Promover usu√°rios ou remover privil√©gios administrativos</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="text-lg font-bold text-secondary mb-4">üëë Administradores Atuais</h3>
                    <div id="currentAdminsList" class="space-y-2 mb-6">
                        <!-- Lista ser√° preenchida dinamicamente -->
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold text-secondary mb-4">üë§ Promover Usu√°rio a Admin</h3>
                    <select id="promoteUserSelect" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-300 bg-white shadow-sm mb-4">
                        <option value="">Selecione um usu√°rio para promover</option>
                    </select>
                    <button onclick="promoteToAdmin()" class="w-full bg-gradient-to-r from-success to-primary hover:from-success/90 hover:to-primary/90 text-white py-3 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                        Promover a Administrador
                    </button>
                </div>
            </div>
            
            <div class="flex justify-center mt-8">
                <button onclick="closeManageAdminsModal()" class="text-gray-600 hover:text-secondary font-semibold py-3 px-6 transition-colors duration-300">
                    Fechar
                </button>
            </div>
            
            <button onclick="closeManageAdminsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-accent transition-colors duration-300 bg-white/80 rounded-full p-2 hover:bg-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Edit Response Modal -->
    <div id="editResponseModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-8 w-full max-w-4xl mx-4 border border-gray-200 max-h-[90vh] overflow-y-auto">
            <div class="text-center mb-6">
                <div class="bg-gradient-to-r from-primary to-accent p-3 rounded-2xl w-12 h-12 mx-auto mb-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-secondary">Editar Resposta do Usu√°rio</h2>
                <p class="text-gray-600 font-medium">Modificar dados enviados pelo usu√°rio</p>
            </div>
            
            <form id="editResponseForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-2">Site</label>
                        <input type="text" id="editSite" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-2">Per√≠odo</label>
                        <input type="text" id="editPeriod" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-2">Quantidade FTE</label>
                        <input type="number" id="editFteCount" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-2">Quantidade Safristas</label>
                        <input type="number" id="editSeasonalCount" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-2">Licen√ßas FTE (todos motivos)</label>
                        <input type="number" id="editMedicalLeaveFte" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-2">Licen√ßas Safristas (todos motivos)</label>
                        <input type="number" id="editMedicalLeaveSeasonal" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" min="0">
                    </div>
                </div>
                
                <div class="flex justify-between pt-6">
                    <button type="button" onclick="closeEditResponseModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-success hover:bg-success/80 text-white px-6 py-3 rounded-lg font-semibold">
                        Salvar Altera√ß√µes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-secondary">Novo Usu√°rio</h2>
                <p class="text-gray-600">Adicionar novo usu√°rio ao sistema</p>
            </div>
            
            <form id="addUserForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-secondary mb-2">Nome Completo</label>
                    <input type="text" id="newUserName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-secondary mb-2">Email</label>
                    <input type="email" id="newUserEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-secondary mb-2">Site</label>
                    <select id="newUserSite" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" required>
                        <option value="">Selecione o site</option>
                        <option value="petrolina">Petrolina</option>
                        <option value="sorriso">Sorriso - Hub Norte</option>
                        <option value="uberlandia">Uberl√¢ndia - Hub Centro Norte</option>
                    </select>
                </div>
                
                <button type="submit" class="w-full bg-success hover:bg-success/80 text-white py-3 rounded-lg font-semibold transition-colors">
                    Criar Usu√°rio
                </button>
                
                <button type="button" onclick="closeAddUserModal()" class="w-full text-gray-600 hover:text-gray-800 py-2">
                    Cancelar
                </button>
            </form>
            
            <button onclick="closeAddUserModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üöÄ SISTEMA AVAN√áADO DE SINCRONIZA√á√ÉO MULTI-DISPOSITIVO EM TEMPO REAL
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        console.log('üöÄ SISTEMA AVAN√áADO MULTI-DISPOSITIVO INICIANDO...');
        
        // Configura√ß√£o avan√ßada do sistema
        const ADVANCED_CONFIG = {
            // Chave √∫nica global - MESMA para todos os dispositivos
            globalKey: 'SAUDE_INTEGRAL_ADVANCED_V5',
            backupKey: 'SAUDE_INTEGRAL_BACKUP_V5',
            syncInterval: 1500, // 1.5 segundos - sincroniza√ß√£o mais r√°pida
            maxBackups: 25,
            version: '5.0.0',
            maxRetries: 3,
            retryDelay: 1000,
            compressionEnabled: true,
            encryptionEnabled: false // Para demo, desabilitado
        };
        
        // Vari√°veis globais avan√ßadas
        let syncTimer = null;
        let heartbeatTimer = null;
        let lastDataHash = null;
        let currentUserType = '';
        let currentUser = null;
        let currentLanguage = 'pt';
        let globalData = {};
        let deviceId = null;
        let isOnline = true;
        let syncRetries = 0;
        let lastSyncTime = null;
        let connectedDevices = new Set();
        let pendingChanges = [];
        let isInitialized = false;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîÑ SISTEMA DE SINCRONIZA√á√ÉO AVAN√áADO EM TEMPO REAL
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        // Inicializar sistema avan√ßado
        function initializeAdvancedSystem() {
            console.log('üîÑ Inicializando sistema avan√ßado...');
            
            try {
                // Gerar ID √∫nico do dispositivo
                deviceId = generateAdvancedDeviceId();
                
                // Carregar dados globais
                loadAdvancedGlobalData();
                
                // Iniciar sincroniza√ß√£o em tempo real
                startAdvancedSync();
                
                // Iniciar heartbeat para detectar dispositivos conectados
                startDeviceHeartbeat();
                
                // Registrar eventos de visibilidade da p√°gina
                registerVisibilityEvents();
                
                // Registrar eventos de rede
                registerNetworkEvents();
                
                // Marcar como inicializado
                isInitialized = true;
                
                console.log('‚úÖ Sistema avan√ßado inicializado com sucesso!');
                updateConnectionStatus('online', 'Sistema Online');
                
            } catch (error) {
                console.error('‚ùå Erro ao inicializar sistema avan√ßado:', error);
                updateConnectionStatus('error', 'Erro de Inicializa√ß√£o');
                
                // Tentar recupera√ß√£o autom√°tica
                setTimeout(() => {
                    console.log('üîÑ Tentando recupera√ß√£o autom√°tica...');
                    initializeAdvancedSystem();
                }, 3000);
            }
        }
        
        // Gerar ID √∫nico avan√ßado do dispositivo
        function generateAdvancedDeviceId() {
            const stored = localStorage.getItem('advancedDeviceId');
            if (stored) return stored;
            
            const id = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 12);
            localStorage.setItem('advancedDeviceId', id);
            return id;
        }
        
        // Carregar dados globais avan√ßados
        function loadAdvancedGlobalData() {
            try {
                const savedData = localStorage.getItem(ADVANCED_CONFIG.globalKey);
                
                if (savedData) {
                    // Tentar descomprimir se necess√°rio
                    const parsedData = ADVANCED_CONFIG.compressionEnabled ? 
                        decompressData(savedData) : JSON.parse(savedData);
                    
                    globalData = parsedData;
                    console.log('‚úÖ Dados globais avan√ßados carregados');
                    console.log(`üìä ${globalData.responses?.length || 0} respostas`);
                    console.log(`üë• ${globalData.users?.length || 0} usu√°rios`);
                    console.log(`üåê ${globalData.metadata?.deviceCount || 1} dispositivos`);
                } else {
                    // Criar estrutura inicial avan√ßada
                    globalData = createAdvancedInitialData();
                    saveAdvancedGlobalData();
                    console.log('‚úÖ Sistema inicializado com dados avan√ßados');
                }
                
                // Registrar este dispositivo
                registerAdvancedDevice();
                
                // Calcular hash dos dados
                lastDataHash = calculateAdvancedDataHash(globalData);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados avan√ßados:', error);
                
                // Tentar restaurar do backup
                if (restoreFromAdvancedBackup()) {
                    console.log('üîÑ Dados restaurados do backup avan√ßado');
                } else {
                    globalData = createAdvancedInitialData();
                    saveAdvancedGlobalData();
                    console.log('üÜï Criados novos dados iniciais');
                }
            }
        }
        
        // Criar dados iniciais avan√ßados
        function createAdvancedInitialData() {
            return {
                version: ADVANCED_CONFIG.version,
                initialized: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                users: getDefaultUsers(),
                responses: [],
                settings: getAdvancedDefaultSettings(),
                metadata: {
                    totalAccess: 1,
                    lastAccess: new Date().toISOString(),
                    deviceCount: 1,
                    devices: [deviceId],
                    activeDevices: new Set([deviceId]),
                    lastHeartbeat: new Date().toISOString(),
                    syncCount: 0,
                    errorCount: 0
                },
                activityLogs: [],
                systemLogs: [{
                    id: 1,
                    type: 'system_init',
                    message: 'Sistema avan√ßado inicializado',
                    timestamp: new Date().toISOString(),
                    deviceId: deviceId
                }]
            };
        }
        
        // Configura√ß√µes avan√ßadas padr√£o
        function getAdvancedDefaultSettings() {
            return {
                workingDaysPerMonth: 22,
                syncInterval: ADVANCED_CONFIG.syncInterval,
                autoBackup: true,
                compressionEnabled: ADVANCED_CONFIG.compressionEnabled,
                maxRetries: ADVANCED_CONFIG.maxRetries,
                lastUpdated: new Date().toISOString(),
                version: '5.0.0'
            };
        }
        
        // Registrar dispositivo avan√ßado
        function registerAdvancedDevice() {
            if (!globalData.metadata) globalData.metadata = {};
            if (!globalData.metadata.devices) globalData.metadata.devices = [];
            if (!globalData.metadata.activeDevices) globalData.metadata.activeDevices = {};
            
            // Adicionar dispositivo se n√£o existir
            if (!globalData.metadata.devices.includes(deviceId)) {
                globalData.metadata.devices.push(deviceId);
            }
            
            // Marcar como ativo
            globalData.metadata.activeDevices[deviceId] = {
                lastSeen: new Date().toISOString(),
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                online: true
            };
            
            globalData.metadata.deviceCount = globalData.metadata.devices.length;
            globalData.metadata.totalAccess = (globalData.metadata.totalAccess || 0) + 1;
            globalData.metadata.lastAccess = new Date().toISOString();
            
            console.log(`üì± Dispositivo registrado: ${deviceId}`);
            console.log(`üåê Total de dispositivos: ${globalData.metadata.deviceCount}`);
        }
        
        // Iniciar sincroniza√ß√£o avan√ßada em tempo real
        function startAdvancedSync() {
            if (syncTimer) clearInterval(syncTimer);
            
            syncTimer = setInterval(() => {
                performAdvancedSync();
            }, ADVANCED_CONFIG.syncInterval);
            
            console.log(`üîÑ Sincroniza√ß√£o avan√ßada ativa a cada ${ADVANCED_CONFIG.syncInterval/1000}s`);
        }
        
        // Realizar sincroniza√ß√£o avan√ßada
        function performAdvancedSync() {
            try {
                const currentData = localStorage.getItem(ADVANCED_CONFIG.globalKey);
                if (currentData) {
                    const parsedData = ADVANCED_CONFIG.compressionEnabled ? 
                        decompressData(currentData) : JSON.parse(currentData);
                    
                    const newHash = calculateAdvancedDataHash(parsedData);
                    
                    // Se os dados mudaram, sincronizar
                    if (newHash !== lastDataHash) {
                        globalData = parsedData;
                        lastDataHash = newHash;
                        lastSyncTime = new Date().toISOString();
                        
                        // Atualizar contadores
                        if (!globalData.metadata) globalData.metadata = {};
                        globalData.metadata.syncCount = (globalData.metadata.syncCount || 0) + 1;
                        
                        // Atualizar interface
                        updateInterfaceAfterSync();
                        
                        // Mostrar notifica√ß√£o de sincroniza√ß√£o
                        showAdvancedSyncNotification();
                        
                        // Atualizar status de conex√£o
                        updateConnectionStatus('synced', 'Sincronizado');
                        
                        console.log('üîÑ Dados sincronizados de outro dispositivo');
                        
                        // Reset retry counter on successful sync
                        syncRetries = 0;
                    }
                }
                
                // Atualizar heartbeat deste dispositivo
                updateDeviceHeartbeat();
                
            } catch (error) {
                console.error('‚ùå Erro na sincroniza√ß√£o avan√ßada:', error);
                
                syncRetries++;
                globalData.metadata.errorCount = (globalData.metadata.errorCount || 0) + 1;
                
                if (syncRetries < ADVANCED_CONFIG.maxRetries) {
                    console.log(`üîÑ Tentativa ${syncRetries}/${ADVANCED_CONFIG.maxRetries} em ${ADVANCED_CONFIG.retryDelay}ms`);
                    setTimeout(() => performAdvancedSync(), ADVANCED_CONFIG.retryDelay);
                } else {
                    updateConnectionStatus('error', 'Erro de Sincroniza√ß√£o');
                    console.error('‚ùå M√°ximo de tentativas de sincroniza√ß√£o atingido');
                }
            }
        }
        
        // Calcular hash avan√ßado dos dados
        function calculateAdvancedDataHash(data) {
            const criticalData = {
                responses: data.responses || [],
                users: data.users || [],
                lastUpdated: data.lastUpdated,
                metadata: {
                    deviceCount: data.metadata?.deviceCount || 0,
                    syncCount: data.metadata?.syncCount || 0
                }
            };
            
            const dataString = JSON.stringify(criticalData);
            
            let hash = 0;
            for (let i = 0; i < dataString.length; i++) {
                const char = dataString.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }
        
        // Atualizar interface ap√≥s sincroniza√ß√£o
        function updateInterfaceAfterSync() {
            // Atualizar gr√°ficos se dashboard vis√≠vel
            if (document.getElementById('dashboard').style.display !== 'none') {
                updateCharts();
            }
            
            // Atualizar tabela admin se vis√≠vel
            if (document.getElementById('adminPanel').style.display !== 'none') {
                refreshAdminTable();
            }
            
            // Atualizar contadores de dispositivos
            updateDeviceCounters();
        }
        
        // Mostrar notifica√ß√£o avan√ßada de sincroniza√ß√£o
        function showAdvancedSyncNotification() {
            const notification = createAdvancedNotification(
                'üîÑ Dados Atualizados',
                'Sincronizado de outro dispositivo',
                'success',
                3000
            );
            
            // Adicionar informa√ß√µes extras
            const extraInfo = document.createElement('div');
            extraInfo.className = 'text-xs opacity-75 mt-1';
            extraInfo.textContent = `${globalData.responses?.length || 0} respostas ‚Ä¢ ${globalData.metadata?.deviceCount || 1} dispositivos`;
            notification.appendChild(extraInfo);
        }
        
        // Criar notifica√ß√£o avan√ßada
        function createAdvancedNotification(title, message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            
            const notification = document.createElement('div');
            notification.className = `
                bg-white rounded-lg shadow-lg border-l-4 p-4 mb-2 transform transition-all duration-300
                ${type === 'success' ? 'border-success' : 
                  type === 'error' ? 'border-accent' : 
                  type === 'warning' ? 'border-yellow-500' : 'border-primary'}
                translate-x-full opacity-0
            `;
            
            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-1">
                        <div class="font-semibold text-secondary text-sm">${title}</div>
                        <div class="text-gray-600 text-xs mt-1">${message}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600 ml-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Animar entrada
            setTimeout(() => {
                notification.classList.remove('translate-x-full', 'opacity-0');
            }, 100);
            
            // Auto remover
            setTimeout(() => {
                notification.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => notification.remove(), 300);
            }, duration);
            
            return notification;
        }
        
        // Iniciar heartbeat de dispositivos
        function startDeviceHeartbeat() {
            if (heartbeatTimer) clearInterval(heartbeatTimer);
            
            heartbeatTimer = setInterval(() => {
                updateDeviceHeartbeat();
                checkDeviceActivity();
            }, 5000); // A cada 5 segundos
            
            console.log('üíì Heartbeat de dispositivos iniciado');
        }
        
        // Atualizar heartbeat do dispositivo
        function updateDeviceHeartbeat() {
            if (!globalData.metadata) globalData.metadata = {};
            if (!globalData.metadata.activeDevices) globalData.metadata.activeDevices = {};
            
            globalData.metadata.activeDevices[deviceId] = {
                ...globalData.metadata.activeDevices[deviceId],
                lastSeen: new Date().toISOString(),
                online: true
            };
            
            globalData.metadata.lastHeartbeat = new Date().toISOString();
        }
        
        // Verificar atividade de dispositivos
        function checkDeviceActivity() {
            if (!globalData.metadata?.activeDevices) return;
            
            const now = new Date();
            const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000);
            
            let activeCount = 0;
            
            Object.keys(globalData.metadata.activeDevices).forEach(id => {
                const device = globalData.metadata.activeDevices[id];
                const lastSeen = new Date(device.lastSeen);
                
                if (lastSeen > fiveMinutesAgo) {
                    device.online = true;
                    activeCount++;
                } else {
                    device.online = false;
                }
            });
            
            // Atualizar contador de dispositivos ativos
            updateDeviceCounters(activeCount);
        }
        
        // Atualizar contadores de dispositivos
        function updateDeviceCounters(activeCount = null) {
            const deviceCountElement = document.getElementById('deviceCount');
            if (deviceCountElement) {
                const total = globalData.metadata?.deviceCount || 1;
                const active = activeCount !== null ? activeCount : 
                    Object.values(globalData.metadata?.activeDevices || {})
                        .filter(d => d.online).length;
                
                deviceCountElement.textContent = `${active}/${total} dispositivos online`;
            }
            
            const lastSyncElement = document.getElementById('lastSync');
            if (lastSyncElement && lastSyncTime) {
                const timeDiff = new Date() - new Date(lastSyncTime);
                const seconds = Math.floor(timeDiff / 1000);
                
                if (seconds < 60) {
                    lastSyncElement.textContent = `Sincronizado h√° ${seconds}s`;
                } else {
                    const minutes = Math.floor(seconds / 60);
                    lastSyncElement.textContent = `Sincronizado h√° ${minutes}m`;
                }
            }
        }
        
        // Registrar eventos de visibilidade da p√°gina
        function registerVisibilityEvents() {
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    console.log('üì± P√°gina oculta - reduzindo sincroniza√ß√£o');
                    // Reduzir frequ√™ncia de sincroniza√ß√£o quando p√°gina n√£o est√° vis√≠vel
                    if (syncTimer) {
                        clearInterval(syncTimer);
                        syncTimer = setInterval(performAdvancedSync, ADVANCED_CONFIG.syncInterval * 3);
                    }
                } else {
                    console.log('üì± P√°gina vis√≠vel - restaurando sincroniza√ß√£o');
                    // Restaurar sincroniza√ß√£o normal
                    startAdvancedSync();
                    // Sincronizar imediatamente
                    performAdvancedSync();
                }
            });
        }
        
        // Registrar eventos de rede
        function registerNetworkEvents() {
            window.addEventListener('online', () => {
                console.log('üåê Conex√£o restaurada');
                isOnline = true;
                updateConnectionStatus('online', 'Online');
                
                // Sincronizar imediatamente quando voltar online
                performAdvancedSync();
                
                // Mostrar notifica√ß√£o
                createAdvancedNotification(
                    'üåê Conex√£o Restaurada',
                    'Sincronizando dados...',
                    'success'
                );
            });
            
            window.addEventListener('offline', () => {
                console.log('üì° Conex√£o perdida');
                isOnline = false;
                updateConnectionStatus('offline', 'Offline');
                
                createAdvancedNotification(
                    'üì° Sem Conex√£o',
                    'Trabalhando offline',
                    'warning'
                );
            });
        }
        
        // Atualizar status de conex√£o
        function updateConnectionStatus(status, message) {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            
            if (indicator && text) {
                // Remover classes anteriores
                indicator.className = 'w-3 h-3 rounded-full';
                
                switch (status) {
                    case 'online':
                        indicator.classList.add('bg-success', 'animate-pulse');
                        break;
                    case 'synced':
                        indicator.classList.add('bg-primary', 'animate-ping');
                        setTimeout(() => {
                            indicator.className = 'w-3 h-3 bg-success rounded-full';
                        }, 1000);
                        break;
                    case 'offline':
                        indicator.classList.add('bg-yellow-500');
                        break;
                    case 'error':
                        indicator.classList.add('bg-accent', 'animate-bounce');
                        break;
                    default:
                        indicator.classList.add('bg-gray-400');
                }
                
                text.textContent = message;
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üíæ SISTEMA AVAN√áADO DE SALVAMENTO E BACKUP
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        // Salvar dados globais avan√ßados
        function saveAdvancedGlobalData() {
            try {
                globalData.lastUpdated = new Date().toISOString();
                globalData.version = ADVANCED_CONFIG.version;
                
                // Atualizar metadata
                if (!globalData.metadata) globalData.metadata = {};
                globalData.metadata.lastSave = new Date().toISOString();
                globalData.metadata.saveCount = (globalData.metadata.saveCount || 0) + 1;
                
                // Criar backup autom√°tico
                createAdvancedBackup();
                
                // Comprimir dados se habilitado
                const dataToSave = ADVANCED_CONFIG.compressionEnabled ? 
                    compressData(globalData) : JSON.stringify(globalData);
                
                // Salvar com chave global √∫nica
                localStorage.setItem(ADVANCED_CONFIG.globalKey, dataToSave);
                
                // Atualizar hash local
                lastDataHash = calculateAdvancedDataHash(globalData);
                
                console.log('‚úÖ Dados globais avan√ßados salvos');
                console.log(`üìä ${globalData.responses?.length || 0} respostas`);
                console.log(`üë• ${globalData.users?.length || 0} usu√°rios`);
                console.log(`üåê ${globalData.metadata?.deviceCount || 1} dispositivos`);
                console.log(`üíæ Save #${globalData.metadata?.saveCount || 1}`);
                
                // Notificar atualiza√ß√£o global
                broadcastAdvancedUpdate();
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar dados avan√ßados:', error);
                
                // Tentar restaurar do backup
                if (restoreFromAdvancedBackup()) {
                    createAdvancedNotification(
                        '‚ö†Ô∏è Erro de Salvamento',
                        'Dados restaurados do backup',
                        'warning'
                    );
                } else {
                    createAdvancedNotification(
                        '‚ùå Erro Cr√≠tico',
                        'Falha ao salvar dados',
                        'error'
                    );
                }
                
                return false;
            }
        }
        
        // Criar backup avan√ßado
        function createAdvancedBackup() {
            try {
                const backupData = {
                    ...globalData,
                    backupCreatedAt: new Date().toISOString(),
                    backupId: Date.now(),
                    backupDeviceId: deviceId
                };
                
                const existingBackups = JSON.parse(localStorage.getItem(ADVANCED_CONFIG.backupKey) || '[]');
                existingBackups.push(backupData);
                
                // Limitar n√∫mero de backups
                if (existingBackups.length > ADVANCED_CONFIG.maxBackups) {
                    existingBackups.splice(0, existingBackups.length - ADVANCED_CONFIG.maxBackups);
                }
                
                const backupsToSave = ADVANCED_CONFIG.compressionEnabled ? 
                    compressData(existingBackups) : JSON.stringify(existingBackups);
                
                localStorage.setItem(ADVANCED_CONFIG.backupKey, backupsToSave);
                console.log('üíæ Backup avan√ßado criado');
                
            } catch (error) {
                console.error('‚ùå Erro ao criar backup avan√ßado:', error);
            }
        }
        
        // Restaurar do backup avan√ßado
        function restoreFromAdvancedBackup() {
            try {
                const backupsData = localStorage.getItem(ADVANCED_CONFIG.backupKey);
                if (!backupsData) return false;
                
                const backups = ADVANCED_CONFIG.compressionEnabled ? 
                    decompressData(backupsData) : JSON.parse(backupsData);
                
                if (backups.length > 0) {
                    const latestBackup = backups[backups.length - 1];
                    globalData = { ...latestBackup };
                    
                    // Limpar propriedades de backup
                    delete globalData.backupCreatedAt;
                    delete globalData.backupId;
                    delete globalData.backupDeviceId;
                    
                    // Salvar dados restaurados
                    const dataToSave = ADVANCED_CONFIG.compressionEnabled ? 
                        compressData(globalData) : JSON.stringify(globalData);
                    
                    localStorage.setItem(ADVANCED_CONFIG.globalKey, dataToSave);
                    lastDataHash = calculateAdvancedDataHash(globalData);
                    
                    console.log('üîÑ Dados restaurados do backup avan√ßado');
                    return true;
                }
            } catch (error) {
                console.error('‚ùå Erro ao restaurar backup avan√ßado:', error);
            }
            return false;
        }
        
        // Comprimir dados (simula√ß√£o - em produ√ß√£o usar biblioteca real)
        function compressData(data) {
            // Simula√ß√£o de compress√£o - em produ√ß√£o usar LZ-string ou similar
            return JSON.stringify(data);
        }
        
        // Descomprimir dados (simula√ß√£o)
        function decompressData(compressedData) {
            // Simula√ß√£o de descompress√£o
            return JSON.parse(compressedData);
        }
        
        // Notificar atualiza√ß√£o avan√ßada
        function broadcastAdvancedUpdate() {
            const event = new CustomEvent('advancedDataUpdated', {
                detail: {
                    timestamp: globalData.lastUpdated,
                    responseCount: globalData.responses?.length || 0,
                    userCount: globalData.users?.length || 0,
                    deviceCount: globalData.metadata?.deviceCount || 1,
                    syncCount: globalData.metadata?.syncCount || 0,
                    deviceId: deviceId
                }
            });
            window.dispatchEvent(event);
        }
        
        // Fun√ß√µes de compatibilidade
        function saveGlobalData() { return saveAdvancedGlobalData(); }
        function saveData() { return saveAdvancedGlobalData(); }
        function saveToSharedDatabase() { return saveAdvancedGlobalData(); }

        // Get default users
        function getDefaultUsers() {
            return [
                {
                    id: 'admin_001',
                    name: 'Ariane Santos',
                    email: 'ariane.santos.ext@bayer.com',
                    password: 'Ari92815081*',
                    type: 'admin',
                    site: 'all',
                    country: 'all',
                    active: true,
                    createdAt: new Date().toISOString(),
                    lastLogin: null,
                    mustChangePassword: false,
                    permissions: ['all']
                }
            ];
        }

        // Authentication functions
        function authenticateUser(email, password, type) {
            console.log('üîê Tentativa de login:', { email, type, totalUsers: globalData.users?.length || 0 });
            
            const user = globalData.users?.find(u => {
                const emailMatch = u.email.toLowerCase().trim() === email.toLowerCase().trim();
                const passwordMatch = u.password === password;
                const typeMatch = u.type === type;
                const isActive = u.active;
                
                console.log('üîç Verificando usu√°rio:', {
                    userEmail: u.email,
                    emailMatch,
                    passwordMatch,
                    typeMatch,
                    isActive,
                    userType: u.type
                });
                
                return emailMatch && passwordMatch && typeMatch && isActive;
            });
            
            console.log('‚úÖ Resultado autentica√ß√£o:', user ? 'SUCESSO' : 'FALHOU');
            return user || null;
        }

        // User activity logging
        function logUserActivity(userId, action, metadata = {}) {
            if (!globalData.activityLogs) globalData.activityLogs = [];
            
            globalData.activityLogs.push({
                id: globalData.activityLogs.length + 1,
                userId: userId,
                action: action,
                metadata: metadata,
                timestamp: new Date().toISOString(),
                deviceId: deviceId,
                ip: 'localhost',
                userAgent: navigator.userAgent
            });
            
            // Keep only last 1000 logs
            if (globalData.activityLogs.length > 1000) {
                globalData.activityLogs = globalData.activityLogs.slice(-1000);
            }
            
            saveAdvancedGlobalData();
        }

        // Translation dictionary
        const translations = {
            pt: {
                main_title: 'INDICADORES ESTRAT√âGICOS',
                subtitle: 'SA√öDE INTEGRAL R&D LATAM',
                user_button: 'Usu√°rio',
                admin_button: 'Administrador',
                chart_filters: 'Filtros dos Gr√°ficos',
                country_label: 'Pa√≠s',
                location_label: 'Localidade',
                business_label: 'Neg√≥cio',
                year_label: 'Ano',
                all_countries: 'Todos os Pa√≠ses',
                all_locations: 'Todas as Localidades',
                all_businesses: 'Todos os Neg√≥cios',
                all_years: 'Todos os Anos',
                formula_text: 'F√≥rmula: (Dias perdidos / Dias contratados) √ó 100',
                absenteeism_general: 'Absente√≠smo Geral (%)',
                absenteeism_location: 'Absente√≠smo por Localidade (%)',
                absenteeism_category: 'Absente√≠smo por Categoria CID (%)',
                absenteeism_trend: 'Tend√™ncia Mensal de Absente√≠smo (%)',
                absenteeism_comparison: 'Comparativo FTE vs Safristas - Absente√≠smo (%)',
                sites_no_response: 'Sites sem Resposta no M√™s',
                last_response: '√öltima resposta',
                login_title: 'Acesso ao Sistema',
                login_subtitle: 'Digite suas credenciais',
                email_label: 'Email',
                password_label: 'Senha',
                login_button: 'Entrar',
                forgot_password: 'Esqueceu a senha?',
                forgot_title: 'Recuperar Senha',
                forgot_subtitle: 'Digite seu email para receber instru√ß√µes',
                send_email: 'Enviar Email',
                back_to_login: 'Voltar ao Login',
                general_info: 'INFORMA√á√ÉO GERAL',
                general_info_desc: 'Dados b√°sicos do per√≠odo e localiza√ß√£o',
                year_question: '1. Ano (selecione apenas um)',
                month_question: '2. M√™s (selecione apenas um)',
                business_question: '3. Neg√≥cio Principal',
                country_question: '4. Pa√≠s',
                site_question: '5. Site',
                fte_count_question: '6. Quantidade de FTE ativo do site',
                seasonal_count_question: '7. Quantidade de safristas ativos do site',
                observations_question: '8. Observa√ß√µes',
                select_month: 'Selecione o m√™s',
                select_business: 'Selecione o neg√≥cio',
                select_country: 'Selecione o pa√≠s',
                select_site: 'Selecione o site',
                january: 'Janeiro',
                february: 'Fevereiro',
                march: 'Mar√ßo',
                april: 'Abril',
                may: 'Maio',
                june: 'Junho',
                july: 'Julho',
                august: 'Agosto',
                september: 'Setembro',
                october: 'Outubro',
                november: 'Novembro',
                december: 'Dezembro',
                brazil: 'Brasil',
                paraguay: 'Paraguai',
                mexico: 'M√©xico',
                medical_leave: 'LICEN√áA M√âDICA',
                medical_leave_desc: 'Dados de afastamentos por motivos de sa√∫de',
                questionnaire_title: 'Question√°rio - Indicadores Estrat√©gicos',
                questionnaire_subtitle: 'Preencha os dados mensais do seu site',
                change_password: 'Alterar Senha',
                current_password: 'Senha Atual',
                new_password: 'Nova Senha',
                confirm_password: 'Confirmar Nova Senha',
                save_password: 'Salvar Nova Senha',
                cancel: 'Cancelar'
            },
            es: {
                main_title: 'INDICADORES ESTRAT√âGICOS',
                subtitle: 'SALUD INTEGRAL R&D LATAM',
                user_button: 'Usuario',
                admin_button: 'Administrador',
                chart_filters: 'Filtros de Gr√°ficos',
                country_label: 'Pa√≠s',
                location_label: 'Localidad',
                business_label: 'Negocio',
                year_label: 'A√±o',
                all_countries: 'Todos los Pa√≠ses',
                all_locations: 'Todas las Localidades',
                all_businesses: 'Todos los Negocios',
                all_years: 'Todos los A√±os',
                formula_text: 'F√≥rmula: (D√≠as perdidos / D√≠as contratados) √ó 100',
                absenteeism_general: 'Ausentismo General (%)',
                absenteeism_location: 'Ausentismo por Localidad (%)',
                absenteeism_category: 'Ausentismo por Categor√≠a CID (%)',
                absenteeism_trend: 'Tendencia Mensual de Ausentismo (%)',
                absenteeism_comparison: 'Comparativo FTE vs Zafreros - Ausentismo (%)',
                sites_no_response: 'Sitios sin Respuesta en el Mes',
                last_response: '√öltima respuesta',
                login_title: 'Acceso al Sistema',
                login_subtitle: 'Ingrese sus credenciales',
                email_label: 'Correo',
                password_label: 'Contrase√±a',
                login_button: 'Ingresar',
                forgot_password: '¬øOlvid√≥ la contrase√±a?',
                forgot_title: 'Recuperar Contrase√±a',
                forgot_subtitle: 'Ingrese su correo para recibir instrucciones',
                send_email: 'Enviar Correo',
                back_to_login: 'Volver al Login',
                general_info: 'INFORMACI√ìN GENERAL',
                general_info_desc: 'Datos b√°sicos del per√≠odo y ubicaci√≥n',
                year_question: '1. A√±o (seleccione solo uno)',
                month_question: '2. Mes (seleccione solo uno)',
                business_question: '3. Negocio Principal',
                country_question: '4. Pa√≠s',
                site_question: '5. Sitio',
                fte_count_question: '6. Cantidad de FTE activo del sitio',
                seasonal_count_question: '7. Cantidad de zafreros activos del sitio',
                observations_question: '8. Observaciones',
                select_month: 'Seleccione el mes',
                select_business: 'Seleccione el negocio',
                select_country: 'Seleccione el pa√≠s',
                select_site: 'Seleccione el sitio',
                january: 'Enero',
                february: 'Febrero',
                march: 'Marzo',
                april: 'Abril',
                may: 'Mayo',
                june: 'Junio',
                july: 'Julio',
                august: 'Agosto',
                september: 'Septiembre',
                october: 'Octubre',
                november: 'Noviembre',
                december: 'Diciembre',
                brazil: 'Brasil',
                paraguay: 'Paraguay',
                mexico: 'M√©xico',
                medical_leave: 'LICENCIA M√âDICA',
                medical_leave_desc: 'Datos de ausencias por motivos de salud',
                questionnaire_title: 'Cuestionario - Indicadores Estrat√©gicos',
                questionnaire_subtitle: 'Complete los datos mensuales de su sitio',
                change_password: 'Cambiar Contrase√±a',
                current_password: 'Contrase√±a Actual',
                new_password: 'Nueva Contrase√±a',
                confirm_password: 'Confirmar Nueva Contrase√±a',
                save_password: 'Guardar Nueva Contrase√±a',
                cancel: 'Cancelar'
            }
        };

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            
            // Update button states
            document.getElementById('btnPT').className = lang === 'pt' ? 
                'bg-white/30 hover:bg-white/40 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-300 border-2 border-white/50 shadow-lg hover:shadow-xl transform scale-105 flex items-center gap-2' :
                'bg-white/10 hover:bg-white/20 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-300 border border-white/20 shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2';
            
            document.getElementById('btnES').className = lang === 'es' ? 
                'bg-white/30 hover:bg-white/40 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-300 border-2 border-white/50 shadow-lg hover:shadow-xl transform scale-105 flex items-center gap-2' :
                'bg-white/10 hover:bg-white/20 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-300 border border-white/20 shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2';
            
            // Update all translatable elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update chart titles
            updateChartTitles();
        }

        function updateChartTitles() {
            const titles = document.querySelectorAll('[data-chart-title]');
            titles.forEach(title => {
                const key = title.getAttribute('data-chart-title');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    title.textContent = translations[currentLanguage][key];
                }
            });
        }

        // Data processing functions
        function getFilteredResponses(filters = {}) {
            let responses = [...(globalData.responses || [])];
            
            if (filters.country && filters.country !== '') {
                responses = responses.filter(r => r.country === filters.country);
            }
            if (filters.site && filters.site !== '') {
                responses = responses.filter(r => r.site === filters.site);
            }
            if (filters.business && filters.business !== '') {
                responses = responses.filter(r => r.business === filters.business);
            }
            if (filters.year && filters.year !== '') {
                responses = responses.filter(r => r.year === filters.year);
            }
            if (filters.month && filters.month !== '') {
                responses = responses.filter(r => r.month === filters.month);
            }
            
            return responses;
        }

        function calculateAbsenteeismFromResponses(responses) {
            if (responses.length === 0) return getDefaultChartData();
            
            // Group by site for location chart
            const bySite = {};
            const byMonth = {};
            const byCid = {
                'CID F': 0, 'CID M': 0, 'CID S': 0, 'CID Z': 0,
                'CID R': 0, 'CID O': 0, 'CID J': 0, 'CID A/B': 0
            };
            
            let totalContractedDaysGlobal = 0;
            
            responses.forEach(response => {
                const workingDays = globalData.settings?.workingDaysPerMonth || 22;
                const fteContracted = response.fteCount * workingDays;
                const seasonalContracted = response.seasonalCount * workingDays;
                const totalContracted = fteContracted + seasonalContracted;
                const totalDays = response.medicalLeaveFteAll + response.medicalLeaveSeasonalAll;
                
                totalContractedDaysGlobal += totalContracted;
                
                // By site
                const siteKey = response.site || 'N√£o informado';
                if (!bySite[siteKey]) {
                    bySite[siteKey] = {
                        totalDays: 0,
                        contractedDays: 0,
                        fteData: 0,
                        safristasData: 0,
                        fteDays: 0,
                        seasonalDays: 0,
                        fteContracted: 0,
                        seasonalContracted: 0
                    };
                }
                
                bySite[siteKey].totalDays += totalDays;
                bySite[siteKey].contractedDays += totalContracted;
                bySite[siteKey].fteDays += response.medicalLeaveFteAll;
                bySite[siteKey].seasonalDays += response.medicalLeaveSeasonalAll;
                bySite[siteKey].fteContracted += fteContracted;
                bySite[siteKey].seasonalContracted += seasonalContracted;
                
                // By month
                const monthNames = {
                    'janeiro': 'Jan', 'fevereiro': 'Fev', 'marco': 'Mar', 'abril': 'Abr',
                    'maio': 'Mai', 'junho': 'Jun', 'julho': 'Jul', 'agosto': 'Ago',
                    'setembro': 'Set', 'outubro': 'Out', 'novembro': 'Nov', 'dezembro': 'Dez'
                };
                const monthShort = monthNames[response.month] || response.month;
                const monthKey = `${monthShort} ${response.year}`;
                
                if (!byMonth[monthKey]) {
                    byMonth[monthKey] = { 
                        totalDays: 0, 
                        contractedDays: 0,
                        sortKey: `${response.year
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c8308af6c67810',t:'MTc1NDc1MjMyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>



